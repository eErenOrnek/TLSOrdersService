<div class="dashboard">
  <div class="page-header">
    <h1>ğŸ“Š Ana Sayfa</h1>
    <p class="subtitle">SipariÅŸ YÃ¶netim Sistemine HoÅŸ Geldiniz</p>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon customers">ğŸ‘¥</div>
      <div class="stat-content">
        <h3>Toplam MÃ¼ÅŸteri</h3>
        <p class="stat-number">{{ statistics().totalCustomers }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon stocks">ğŸ“¦</div>
      <div class="stat-content">
        <h3>Stok Kalemleri</h3>
        <p class="stat-number">{{ statistics().totalStocks }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon orders">ğŸ›’</div>
      <div class="stat-content">
        <h3>Toplam SipariÅŸ</h3>
        <p class="stat-number">{{ statistics().totalOrders }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon revenue">ğŸ’°</div>
      <div class="stat-content">
        <h3>Toplam Ciro</h3>
        <p class="stat-number">{{ statistics().totalRevenue | number:'1.2-2' }} â‚º</p>
      </div>
    </div>
  </div>

  <div class="quick-actions">
    <h2>ğŸ“Š Raporlar ve Sorgular</h2>
    <div class="actions-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
      
      <!-- 1. ÃœrÃ¼nÃ¼ alan mÃ¼ÅŸteriler -->
      <div class="action-card" style="cursor: default; flex-direction: column; align-items: stretch;">
        <div class="action-icon">ğŸ”</div>
        <h3>ÃœrÃ¼ne GÃ¶re MÃ¼ÅŸteriler</h3>
        <p style="margin-bottom: 12px;">SeÃ§ilen Ã¼rÃ¼nÃ¼ alan mÃ¼ÅŸterilerin listesi</p>
        <select 
          class="form-control" 
          [value]="selectedStockId()"
          (change)="selectedStockId.set(parseInt($any($event.target).value))"
          style="margin-bottom: 8px;"
        >
          <option value="0">ÃœrÃ¼n seÃ§in...</option>
          @for (stock of stocks(); track stock.stockId) {
            <option [value]="stock.stockId">{{ stock.stockName }}</option>
          }
        </select>
        <button class="btn btn-primary" (click)="getCustomersByStock()" [disabled]="loading()">
          {{ loading() ? 'YÃ¼kleniyor...' : 'Rapor OluÅŸtur' }}
        </button>
      </div>

      <!-- 2. Ã‡oklu Ã¼rÃ¼n alan mÃ¼ÅŸteriler -->
      <div class="action-card" style="cursor: pointer;" (click)="getCustomersWithMultipleItems()">
        <div class="action-icon">ğŸ“ˆ</div>
        <h3>Ã‡oklu ÃœrÃ¼n SipariÅŸleri</h3>
        <p>SipariÅŸteki Ã¼rÃ¼n miktarÄ± 1'den fazla olan mÃ¼ÅŸteriler</p>
      </div>

      <!-- 3. FarklÄ± adresli mÃ¼ÅŸteriler -->
      <div class="action-card" style="cursor: pointer;" (click)="getCustomersDifferentAddresses()">
        <div class="action-icon">ğŸ </div>
        <h3>FarklÄ± Adresli MÃ¼ÅŸteriler</h3>
        <p>Fatura ve teslimat adresi farklÄ± olan mÃ¼ÅŸteriler</p>
      </div>

      <!-- 4. MÃ¼ÅŸteri adÄ±na gÃ¶re sipariÅŸler -->
      <div class="action-card" style="cursor: default; flex-direction: column; align-items: stretch;">
        <div class="action-icon">ï¿½</div>
        <h3>MÃ¼ÅŸteriye GÃ¶re SipariÅŸler</h3>
        <p style="margin-bottom: 12px;">MÃ¼ÅŸteri adÄ±na gÃ¶re sipariÅŸ listesi</p>
        <input 
          type="text" 
          class="form-control" 
          [value]="customerNameSearch()"
          (input)="customerNameSearch.set($any($event.target).value)"
          placeholder="MÃ¼ÅŸteri adÄ± (Ã¶rn: TLS)"
          style="margin-bottom: 8px;"
        />
        <button class="btn btn-primary" (click)="getOrdersByCustomerName()" [disabled]="loading()">
          {{ loading() ? 'YÃ¼kleniyor...' : 'Rapor OluÅŸtur' }}
        </button>
      </div>

      <!-- 5. Åehre gÃ¶re sipariÅŸ sayÄ±sÄ± -->
      <div class="action-card" style="cursor: default; flex-direction: column; align-items: stretch;">
        <div class="action-icon">ğŸŒ†</div>
        <h3>Åehre GÃ¶re SipariÅŸ SayÄ±sÄ±</h3>
        <p style="margin-bottom: 12px;">Belirli bir ÅŸehirdeki toplam sipariÅŸ sayÄ±sÄ±</p>
        <input 
          type="text" 
          class="form-control" 
          [value]="citySearch()"
          (input)="citySearch.set($any($event.target).value)"
          placeholder="Åehir adÄ± (Ã¶rn: Ä°stanbul)"
          style="margin-bottom: 8px;"
        />
        <button class="btn btn-primary" (click)="getOrderCountByCity()" [disabled]="loading()">
          {{ loading() ? 'YÃ¼kleniyor...' : 'Rapor OluÅŸtur' }}
        </button>
      </div>

    </div>
  </div>

  <!-- Rapor SonuÃ§larÄ± Modal -->
  @if (reportData()) {
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px;">
      <div style="background: white; border-radius: 12px; max-width: 900px; max-height: 80vh; overflow: auto; padding: 24px; width: 100%;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0;">ï¿½ Rapor SonuÃ§larÄ±</h2>
          <button class="btn btn-secondary" (click)="closeReport()">âŒ Kapat</button>
        </div>

        <!-- ÃœrÃ¼ne gÃ¶re mÃ¼ÅŸteriler -->
        @if (reportType() === 'customersByStock') {
          @if (reportData().length === 0) {
            <p class="empty-state">Bu Ã¼rÃ¼nÃ¼ alan mÃ¼ÅŸteri bulunmamaktadÄ±r.</p>
          } @else {
            @for (customer of reportData(); track customer.customerId) {
              <div style="padding: 16px; background: #f8f9fa; border-radius: 8px; margin-bottom: 12px;">
                <h3 style="margin: 0 0 12px 0;">{{ customer.customerName }}</h3>
                @if (customer.addresses.length > 0) {
                  <div style="margin-left: 16px;">
                    @for (address of customer.addresses; track address.addressId) {
                      <div style="margin-bottom: 8px;">
                        <strong>{{ address.addressType }}:</strong> {{ address.address }}, {{ address.town }}, {{ address.city }}, {{ address.country }}
                        <br><small>ğŸ“§ {{ address.email }} | ğŸ“ {{ address.phone }}</small>
                      </div>
                    }
                  </div>
                } @else {
                  <p style="margin-left: 16px; color: #6c757d;">Adres bilgisi bulunmamaktadÄ±r.</p>
                }
              </div>
            }
          }
        }

        <!-- Ã‡oklu Ã¼rÃ¼n sipariÅŸleri -->
        @if (reportType() === 'multipleItems') {
          @if (reportData().length === 0) {
            <p class="empty-state">Birden fazla Ã¼rÃ¼n iÃ§eren sipariÅŸ bulunmamaktadÄ±r.</p>
          } @else {
            <table class="table">
              <thead>
                <tr>
                  <th>MÃ¼ÅŸteri</th>
                  <th>SipariÅŸ No</th>
                  <th>ÃœrÃ¼n</th>
                  <th>Miktar</th>
                  <th>Tarih</th>
                </tr>
              </thead>
              <tbody>
                @for (item of reportData(); track item.orderId + '-' + item.customerId) {
                  <tr>
                    <td>{{ item.customerName }}</td>
                    <td>{{ item.orderNo }}</td>
                    <td>{{ item.stockName }}</td>
                    <td><strong>{{ item.amount }}</strong></td>
                    <td>{{ item.orderDate | date:'dd.MM.yyyy' }}</td>
                  </tr>
                }
              </tbody>
            </table>
          }
        }

        <!-- FarklÄ± adresli mÃ¼ÅŸteriler -->
        @if (reportType() === 'differentAddresses') {
          @if (reportData().length === 0) {
            <p class="empty-state">FarklÄ± teslimat ve fatura adresi olan mÃ¼ÅŸteri bulunmamaktadÄ±r.</p>
          } @else {
            @for (customer of reportData(); track customer.customerId + '-' + customer.orderId) {
              <div style="padding: 16px; background: #f8f9fa; border-radius: 8px; margin-bottom: 12px;">
                <h3 style="margin: 0 0 12px 0;">{{ customer.customerName }} - {{ customer.orderNo }}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                  <div>
                    <strong>ğŸ“¦ Teslimat Adresi:</strong><br>
                    {{ customer.deliveryAddress.address }}, {{ customer.deliveryAddress.town }}, {{ customer.deliveryAddress.city }}
                  </div>
                  <div>
                    <strong>ğŸ§¾ Fatura Adresi:</strong><br>
                    {{ customer.invoiceAddress.address }}, {{ customer.invoiceAddress.town }}, {{ customer.invoiceAddress.city }}
                  </div>
                </div>
              </div>
            }
          }
        }

        <!-- MÃ¼ÅŸteriye gÃ¶re sipariÅŸler -->
        @if (reportType() === 'ordersByCustomer') {
          @if (reportData().length === 0) {
            <p class="empty-state">Bu mÃ¼ÅŸteriye ait sipariÅŸ bulunmamaktadÄ±r.</p>
          } @else {
            @for (order of reportData(); track order.orderId) {
              <div style="padding: 16px; background: #f8f9fa; border-radius: 8px; margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                  <div>
                    <h3 style="margin: 0;">{{ order.orderNo }}</h3>
                    <small>{{ order.orderDate | date:'dd.MM.yyyy' }}</small>
                  </div>
                  <div style="text-align: right;">
                    <strong>{{ order.totalPrice | number:'1.2-2' }} â‚º</strong><br>
                    <small>Vergi: {{ order.tax | number:'1.2-2' }} â‚º</small>
                  </div>
                </div>
                @if (order.orderDetails.length > 0) {
                  <table style="width: 100%; font-size: 14px;">
                    <thead>
                      <tr style="background: #dee2e6;">
                        <th style="padding: 8px;">ÃœrÃ¼n</th>
                        <th style="padding: 8px; text-align: right;">Miktar</th>
                        <th style="padding: 8px; text-align: right;">Fiyat</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (detail of order.orderDetails; track detail.orderDetailId) {
                        <tr>
                          <td style="padding: 8px;">{{ detail.stockName }}</td>
                          <td style="padding: 8px; text-align: right;">{{ detail.amount }}</td>
                          <td style="padding: 8px; text-align: right;">{{ detail.price | number:'1.2-2' }} â‚º</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                }
              </div>
            }
          }
        }

        <!-- Åehre gÃ¶re sipariÅŸ sayÄ±sÄ± -->
        @if (reportType() === 'ordersByCity') {
          <div style="text-align: center; padding: 40px;">
            <h1 style="font-size: 72px; margin: 0; color: #667eea;">{{ reportData().orderCount }}</h1>
            <p style="font-size: 24px; margin-top: 16px;">
              <strong>{{ reportData().city }}</strong> ÅŸehrinde toplam sipariÅŸ sayÄ±sÄ±
            </p>
          </div>
        }

      </div>
    </div>
  }
</div>
